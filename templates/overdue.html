{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã</h2>

    {% if items %}
    <div class="table-responsive">
        <table class="table table-hover table-bordered">
            <thead class="table-primary">
                <tr>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>

                    <th>–ü—Ä–æ–ø—É—â. –ø–ª–∞—Ç–µ–∂–∏</th>
                </tr>
            </thead>
            <tbody>

                {% for item in items %}
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ -->
                <tr data-bs-toggle="collapse" data-bs-target="#details{{ item.id }}" style="cursor: pointer;">
                    <td>{{ item.client_name }}</td>




                   <td>
                    <div class="d-flex flex-wrap gap-2">
                     {% for month in item.missed_months %}
                     <span class="badge bg-danger rounded-pill">
                     {{ month|ru_month }}
                     </span>



                    {% endfor %}
    </div>
</td>

             <tr class="collapse bg-light" id="details{{ item.id }}">
    <td colspan="7">
        <div class="p-3">


            <ul class="list-unstyled">
                <li class="mb-2"><strong>–î–∞—Ç–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:</strong> {{ item.created_at.strftime('%d.%m.%Y') }}</li>
                  <li class="mb-2"><strong>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞:</strong>
                                    {% if item.first_payment_date %}
                                        {{ item.first_payment_date.strftime('%d.%m.%Y') }}
                                    {% else %}
                                        –ù–µ —É–∫–∞–∑–∞–Ω–∞
                                    {% endif %}
                <li class="mb-2"><strong>–¢–æ–≤–∞—Ä:</strong> {{ item.name }}</li>
                <li class="mb-2"><strong>–û–±—â–∏–π —Å—Ä–æ–∫:</strong> {{ item.total_months }} –º–µ—Å.</li>
                <li class="mb-2"><strong>–û–ø–ª–∞—á–µ–Ω–æ:</strong> <span class="text-success">{{ item.payments_made }} –º–µ—Å.</span></li>
                <li class="mb-2"><strong>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ:</strong> <span class="text-danger fw-bold">{{ item.overdue_months }}–º–µ—Å.</span></li>
               <li class="mb-2"><strong>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂:</strong> {{ "%.2f"|format(item.monthly_payment) | rub }}</li>
            </ul>

            <a href="tel:{{ item.client_phone }}" class="btn btn-primary mt-2">
                üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å
            </a>
            </div>
          </td>
          </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

  {% set total_monthly = items | map(attribute='monthly_payment') | sum %}


<p>
   –í—Å–µ–≥–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤: <strong>{{ items|length }}</strong> |<br>
</p>

    {% else %}
    <div class="alert alert-success">
        <i class="bi bi-check-circle-fill"></i> –ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!
    </div>
    {% endif %}
</div>

<style>
    .table {
        font-size: 14px;
        white-space: nowrap; /* üëà –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª–∫–µ –ª–∏—Å—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É */
    }
    .badge {
        font-size: 0.8em;
        padding: 0.35em 0.65em;
    }
    .alert {
        max-width: 600px;
        margin: 0 auto;
    }

    .table-responsive {
        overflow-x: auto; /* üëà —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
    }
</style>
{% endblock %}