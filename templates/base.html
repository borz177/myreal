<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ Merriweather -->
<!-- Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<link rel="icon" href="{{ url_for('static', filename='icons/favicon.ico', v='2') }}">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#0F71F2"> <!-- –∏–ª–∏ black / black-translucent -->
<meta name="theme-color" content="#0F71F2"> <!-- –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞—à —Å–∏–Ω–∏–π -->
<!-- Bootstrap Icons -->


<!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flatpickr.min.css') }}">

<link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/add-payment.css') }}">



<style>
  .navbar .nav-link {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #ffffff !important;
  }

  .navbar .nav-link:hover {
    color: #ffc107 !important;
  }


</style>
<style>
  :root {
    --safe-bottom: env(safe-area-inset-bottom);
  }

  .main-content {
    padding-bottom: calc(50px + var(--safe-bottom)); /* 90px ‚Äî –≤—ã—Å–æ—Ç–∞ –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
  }

  @supports (padding-bottom: env(safe-area-inset-bottom)) {
    .main-content {
      padding-bottom: calc(50px + env(safe-area-inset-bottom));
    }
  }
</style>

<style>
/* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dropdown-submenu –¥–ª—è Bootstrap 5 */
.dropdown-submenu {
  position: relative;
}

.dropdown-submenu .dropdown-menu {
  top: 0;
  left: 100%;
  margin-left: .1rem;
  margin-right: .1rem;
  display: none;
}

.dropdown-submenu:hover > .dropdown-menu {
  display: block;
}
</style>

</head>
<body>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div id="flash-container" class="mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
<header>
    <script>
      setTimeout(() => {
        const container = document.getElementById('flash-container');
        if (container) {
          container.style.transition = 'opacity 0.5s ease-out';
          container.style.opacity = '0';
          setTimeout(() => container.remove(), 500);
        }
      }, 1000); // 1 —Å–µ–∫—É–Ω–¥–∞
    </script>
      </header>
  {% endif %}
{% endwith %}


<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold text-uppercase" href="/dashboard">
  <span style="letter-spacing: 1px; font-family: 'Montserrat', sans-serif;">
    –†–ê–°–°–†–û–ß–ö–ê<span class="text-warning">+</span>
  </span>
</a>



        <div class="collapse navbar-collapse d-none d-md-flex" id="navbarNav">
            <!-- –õ–ï–í–ê–Ø —á–∞—Å—Ç—å -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/dashboard">–û—Ñ–æ—Ä–º–∏—Ç—å</a></li>
                <li class="nav-item"><a class="nav-link" href="/investors/add">–ò–Ω–≤–µ—Å—Ç–æ—Ä—ã</a></li>
                <li class="nav-item"><a class="nav-link" href="/clients">–ö–ª–∏–µ–Ω—Ç—ã</a></li>
              <li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="cashboxDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    –ö–∞—Å—Å–∞
  </a>
  <ul class="dropdown-menu" aria-labelledby="cashboxDropdown">

    <li><a class="dropdown-item" href="/payments">–ü–ª–∞—Ç–µ–∂–∏</a></li>

    <!-- üìå –ö–Ω–æ–ø–∫–∞-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–æ–¥–º–µ–Ω—é -->
    <li>
      <a class="dropdown-item d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#submenuBalance" role="button" aria-expanded="false" aria-controls="submenuBalance">
        –°—á—ë—Ç
        <i class="bi bi-chevron-down small ms-2"></i>
      </a>

      <!-- üìå –°–∫—Ä—ã—Ç–æ–µ –ø–æ–¥–º–µ–Ω—é -->
      <div class="collapse" id="submenuBalance">
        <ul class="list-unstyled ps-3">
          <li><a class="dropdown-item" href="/balance">–°—á–µ—Ç–∞</a></li>
          <li><a class="dropdown-item" href="/income">–ü—Ä–∏—Ö–æ–¥</a></li>
          <li><a class="dropdown-item" href="/expense">–†–∞—Å—Ö–æ–¥</a></li>
          <li><a class="dropdown-item" href="/transactions">–ñ—É—Ä–Ω–∞–ª</a></li>
        </ul>
      </div>
    </li>
  </ul>
</li>


                <li class="nav-item"><a class="nav-link" href="/contracts">–î–æ–≥–æ–≤–æ—Ä—ã</a></li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center" href="/overdue">
                         –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
                        {% if overdue_count is defined and overdue_count > 0 %}
                            <span class="badge bg-danger ms-2 fw-bold">{{ overdue_count }}</span>
                        {% else %}
                            <span class="badge bg-secondary ms-2"></span>
                        {% endif %}
                    </a>
                </li>
            </ul>

            <!-- –ü–†–ê–í–ê–Ø —á–∞—Å—Ç—å -->
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                {% if current_user.is_authenticated and current_user.is_admin %}
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center" href="{{ url_for('admin_users') }}">
                        üë§ <span class="ms-1">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </a>
                </li>
                {% endif %}

            {% if current_user.is_authenticated and current_user.is_admin %}
              <li class="nav-item">
              <a class="nav-link" href="{{ url_for('check_clients') }}">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞</a>
                </li>
             {% endif %}


                {% if current_user.is_authenticated %}
               <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
        <i class="bi bi-person-circle me-1"></i>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="{{ url_for('profile') }}">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
        {% if current_user.is_authenticated %}
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a></li>
        {% endif %}
    </ul>
</li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="main-content container mb-5">
    {% block content %}{% endblock %}
</div>


{% include 'mobile_nav.html' %}


  <!-- Bootstrap JS -->

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
<script>
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
  menu.addEventListener('click', function (e) {
    e.stopPropagation();  // –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω—É—Ç—Ä–∏
  });
});

document.addEventListener("DOMContentLoaded", function () {
  const cashboxDropdown = document.getElementById('cashboxDropdown');
  const submenuBalance = document.getElementById('submenuBalance');

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–º–µ–Ω—é –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é "–ö–∞—Å—Å–∞"
  cashboxDropdown.addEventListener('click', function () {
    if (submenuBalance.classList.contains('show')) {
      const bsCollapse = bootstrap.Collapse.getInstance(submenuBalance);
      if (bsCollapse) {
        bsCollapse.hide();
      } else {
        new bootstrap.Collapse(submenuBalance, { toggle: false }).hide();
      }
    }
  });
});
</script>




 <!--JavaScript –¥–ª—è –º–∞—Å–∫–∏ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞-->
<script src="https://unpkg.com/imask"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const maskPhoneField = (inputId) => {
      const input = document.getElementById(inputId);
      if (input) {
        const mask = IMask(input, {
          mask: '{+7} (000) 000-00-00'
        });

        input.addEventListener("focus", function () {
          if (input.value.trim() === "") {
            input.value = "+7 ";
            mask.updateValue();
          }
        });
      }
    };

    maskPhoneField("client_phone");
    maskPhoneField("guarantor_phone");
  });
</script>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/service-worker.js')
        .then(reg => console.log('‚úÖ SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', reg.scope))
        .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW:', err));
    });

    // –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Service Worker
    navigator.serviceWorker.addEventListener('message', event => {
      if (event.data.action === 'showLoadingIndicator') {
        document.getElementById('loadingIndicator')?.style.setProperty('display', 'block');
      }
      if (event.data.action === 'hideLoadingIndicator') {
        document.getElementById('loadingIndicator')?.style.setProperty('display', 'none');
      }
    });
  }
</script>



<script src="https://unpkg.com/htmx.org@1.9.12"></script>
<!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
<script src="{{ url_for('static', filename='js/flatpickr.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/particles.min.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/inputmask.min.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/app.js') }}" defer></script>

</body>
</html>
