{% extends "base.html" %}

{% block title %}Профиль пользователя{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Профиль пользователя</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('profile') }}" id="profileForm">
                        <div class="mb-3">
                            <label for="email" class="form-label">Электронная почта</label>
                            <input type="email" class="form-control" id="email" value="{{ current_user.email }}" readonly>
                            <div class="form-text">Email нельзя изменить</div>
                        </div>

                        <div class="mb-3">
                            <label for="name" class="form-label">Ваше имя</label>
                            <input type="text" class="form-control" id="name" name="name"
                                   value="{{ current_user.name or '' }}" placeholder="Введите ваше имя">
                        </div>

                        <!-- Номер телефона -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">Номер телефона</label>
                            <input type="text" class="form-control" id="phone" name="phone"
                                   value="{{ current_user.phone or '' }}"
                                   placeholder="+7 (___) ___-__-__">

                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-4" id="formButtons" style="display: none;">
                            <button type="button" class="btn btn-outline-secondary" id="cancelChanges">Отменить</button>
                            <button type="submit" class="btn btn-primary">Сохранить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    #formButtons {
        transition: all 0.3s ease;
        opacity: 0;
        height: 0;
        overflow: hidden;
    }

    #formButtons.visible {
        opacity: 1;
        height: auto;
        padding-top: 1rem;
        border-top: 1px solid #eee;
        margin-top: 1rem;
    }
</style>

    <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.7/dist/inputmask.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('profileForm');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const formButtons = document.getElementById('formButtons');
    const cancelButton = document.getElementById('cancelChanges');

    // Сохраняем исходные значения
    const initialValues = {
        name: nameInput.value,
        phone: phoneInput.value
    };

    // Проверяем изменения в полях
    function checkForChanges() {
        const currentValues = {
            name: nameInput.value,
            phone: phoneInput.value
        };

        const hasChanges = currentValues.name !== initialValues.name ||
                          currentValues.phone !== initialValues.phone;

        if (hasChanges) {
            formButtons.classList.add('visible');
            formButtons.style.display = 'flex';
        } else {
            formButtons.classList.remove('visible');
            formButtons.style.display = 'none';
        }
    }

    // Отслеживаем изменения в полях
    nameInput.addEventListener('input', checkForChanges);
    phoneInput.addEventListener('input', checkForChanges);

    // Кнопка отмены
    cancelButton.addEventListener('click', function() {
        nameInput.value = initialValues.name;
        phoneInput.value = initialValues.phone;
        formButtons.classList.remove('visible');
        formButtons.style.display = 'none';
    });
// Маска
  phoneInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // Только цифры

    // Замена 8 на 7 и добавление 7, если нужно
    if (value.startsWith('8') && value.length > 1) {
        value = '7' + value.slice(1);
    } else if (!value.startsWith('7')) {
        value = '7' + value;
    }

    // Ограничение: 11 цифр (7 + 10)
    value = value.substring(0, 11);

    // Форматирование
    let formatted = '+7';
    if (value.length > 1) formatted += ' (' + value.substring(1, 4);
    if (value.length >= 4) formatted += ') ' + value.substring(4, 7);
    if (value.length >= 7) formatted += '-' + value.substring(7, 9);
    if (value.length >= 9) formatted += '-' + value.substring(9, 11);

    // Установка значения
    e.target.value = formatted;
});
});
</script>
{% endblock %}